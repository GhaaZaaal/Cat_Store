<!-- confirm_reservation.html -->
{% extends 'base.html' %} {% block content %}
<h1 class="text-center mb-4">Confirm Reservation</h1>

<div class="container">
	<div class="row">
		<div class="col-md-6 text-center">
			<img
				src="{{ url_for('static', filename='cat-images/' + cat.image) }}"
				alt="{{ cat.name }}"
				class="img-fluid cat-image"
			/>
		</div>
		<div class="col-md-6">
			<div class="cat-details">
				<p><strong>Cat Name:</strong> {{ cat.name }}</p>
				<p><strong>Color:</strong> {{ cat.color }}</p>
				<p><strong>Eye Color:</strong> {{ cat.eye_color }}</p>
				<p><strong>Age:</strong> {{ cat.age }}</p>
				<p><strong>Gender:</strong> {{ cat.gender }}</p>
				<p>
					<strong>Price:</strong>
					<span class="price">${{ cat.price }}</span>
				</p>
				<p>
					<strong>Status:</strong>
					{% if cat.reserved_by %} Reserved {% else %} Available {%
					endif %}
				</p>
			</div>

			<form
				action="{{ url_for('auth.confirm_Reservation', cat_id=cat.id) }}"
				method="POST"
			>
				{% if remaining_time %}
				<div class="timer">
					<p>
						<strong>Time Remaining for Reservation:</strong>
						<span id="timeLeft"></span>
					</p>
				</div>
				<script>
					// JavaScript to calculate the countdown from remaining time
					const totalSeconds = {{ remaining_time.total_seconds() | int }};
					let countdown = totalSeconds;

					const timerElement = document.getElementById('timeLeft');
					function updateTimer() {
					    const days = Math.floor(countdown / (24 * 3600));
					    const hours = Math.floor((countdown % (24 * 3600)) / 3600);
					    const minutes = Math.floor((countdown % 3600) / 60);
					    const seconds = countdown % 60;

					    timerElement.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;

					    if (countdown > 0) {
					        countdown -= 1;
					        setTimeout(updateTimer, 1000);
					    } else {
					        // If time runs out, refresh the page
					        setTimeout(function() {
					            location.reload();
					        }, 1000);  // Refresh after 1 second
					    }
					}

					updateTimer();
				</script>
				{% endif %}
				<input
					type="hidden"
					name="csrf_token"
					value="{{ csrf_token() }}"
				/>
				{% if button_disabled and not gallery %}
				<button
					type="button"
					class="btn btn-success"
					id="confirmButton"
					disabled
				>
					Confirmed
				</button>
				<button type="submit" class="btn btn-danger" id="confirmButton">
					Cancel
				</button>
				{% elif gallery %}
				<button
					type="submit"
					class="btn btn-success"
					id="confirmButton"
				>
					Confirm
				</button>
				<button
					type="submit"
					class="btn btn-success"
					id="confirmButton"
				>
					<a href="{{ url_for('auth.gallery') }}">Gallery</a>
				</button>
				{% elif reserve_again %}
				<button
					type="submit"
					class="btn btn-success"
					id="confirmButton"
				>
					Reserve Again
				</button>
				<button
					type="submit"
					class="btn btn-success"
					id="confirmButton"
				>
					<a href="{{ url_for('auth.gallery') }}">Gallery</a>
				</button>
				{% else %}
				<button
					type="submit"
					class="btn btn-success"
					id="confirmButton"
				>
					Confirm
				</button>
				{% endif %}
			</form>
		</div>
	</div>
</div>

<style>
	.cat-image {
		max-width: 100%;
		height: auto;
		border-radius: 8px;
	}

	.price {
		font-size: 1.5rem;
		color: #28a745;
		font-weight: bold;
	}

	.cat-details p {
		font-size: 1.2rem;
		margin-bottom: 0.5rem;
	}

	.confirmation-message {
		margin-top: 20px;
	}

	#confirmButton {
		width: 100%;
	}
</style>
{% endblock %}
